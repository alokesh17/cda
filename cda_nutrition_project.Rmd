---
title: "cda_nutrition_project"
author: "Alokesh Manna"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

All the data is in XPT format. So need to have in a data frame. The explanation is in the doc file just after the data file

```{r}
# install.packages("haven")
# install.packages("writexl")
library(haven)
library(writexl)
```

First we have the demography data downloaded.
```{r}
# Load the XPT file
#<https://wwwn.cdc.gov/nchs/nhanes/search/datapage.aspx?Component=Demographics&Cycle=2021-2023>
data <- read_xpt("~/downloads/DEMO_L.XPT")
df_demography=as.data.frame(data)
```


```{r}
head(df_demography)
```

```{r}
colnames(df_demography)
```


```{r}
summary(df_demography)
```



RIDAGEYR - Age in years at screening will be taken.

DMDEDUC2 - Education level - Adults 20+. Whether has a college education or not!

If it is 1,2,3 then no college education. If 4 and 5, then has college education.

RIDRETH1 - Race/Hispanic origin from 1 to 5, see from codebook
Value 4 is concerned. Non Hispanic black. 3	Non-Hispanic White
4	Non-Hispanic Black.

DMDYRUSR - Length of time in US. Immigration effects on blood pressure a lot. 

5006 people had college education. Non hispanic black are 1597. DMDYRUSR has 
10058 NA (did the just entered?)! 5575 male, 6358 female.
```{r}
df_demography|>
  mutate(DMDEDUC2=ifelse(DMDEDUC2>3,1,0))|> #pull(DMDEDUC2)|>table(), >3 college education
  mutate(RIDRETH1=ifelse(RIDRETH1==4,1,0))|>#|>pull(RIDRETH1)|>table() ## Non Hispanic black are 1, rst 0
  #pull(RIAGENDR)|>table(), 1 male, 2 female, check from doc file, no NA
  
```




##definition in Demo_L_Doc

# SEQN - Respondent sequence number
# SDDSRVYR - Data release cycle
# RIDSTATR - Interview/Examination status
# RIAGENDR - Gender
# RIDAGEYR - Age in years at screening
# RIDAGEMN - Age in months at screening - 0 to 24 mos
# RIDRETH1 - Race/Hispanic origin from 1 to 5, see from codebook
# RIDRETH3 - Race/Hispanic origin w/ NH Asian
# RIDEXMON - Six-month time period
# RIDEXAGM - Age in months at exam - 0 to 19 years
# DMQMILIZ - Served active duty in US Armed Forces
# DMDBORN4 - Country of birth
# DMDYRUSR - Length of time in US
# DMDEDUC2 - Education level - Adults 20+
# DMDMARTZ - Marital status
# RIDEXPRG - Pregnancy status at exam
# DMDHHSIZ - Total number of people in the Household
# DMDHRGND - HH ref person’s gender
# DMDHRAGZ - HH ref person’s age in years
# DMDHREDZ - HH ref person’s education level
# DMDHRMAZ - HH ref person’s marital status
# DMDHSEDZ - HH ref person’s spouse’s education level
# WTINT2YR - Full sample 2-year interview weight
# WTMEC2YR - Full sample 2-year MEC exam weight
# SDMVSTRA - Masked variance pseudo-stratum
# SDMVPSU - Masked variance pseudo-PSU
# INDFMPIR - Ratio of family income to poverty
# National Health and Nutrition Examination Survey
# August 2021-August 2023 Data Documentation, Codebook, and Frequencies
# Demographic Variables and Sample Weights (DEMO_L)
# Data File: DEMO_L.xpt
# First Published: September 2024
# Last Revised: NA
# Component Description


Now blood pressure and cholestorol
```{r}
#bloodpressure and cholestorol
#<https://wwwn.cdc.gov/nchs/nhanes/search/datapage.aspx?Component=Questionnaire&Cycle=2021-2023>
data_bloodpressure <- read_xpt("~/downloads/BPQ_L.XPT")
data_bloodpressure<-as.data.frame(data_bloodpressure)
colnames(data_bloodpressure)
```


BPQ020: {Have you/Has SP} ever been told by a doctor or other health professional that {you/s/he} had hypertension, also called high blood pressure?

BPQ030	{Were you/Was SP} told on 2 or more different visits that {you/s/he} had hypertension, also called high blood pressure?

BPQ080	{Have you/Has SP} ever been told by a doctor or other health professional that {your/his/her} blood cholesterol level was high?

BPQ150	{Are you/Is SP} now taking any medication prescribed by a doctor for {your/his/her/SP's} high blood pressure?

BPQ101D	{Are you/Is SP} now taking any medication prescribed by a doctor lower {your/his/her/SP's} blood cholesterol?

```{r}
head(data_bloodpressure)
```

```{r}
summary(data_bloodpressure)
```
```{r}
data_bloodpressure|>
  pull(BPQ020)|>
  table()
```


##final question

Q1: (more on blood pressure! fix one)
Does people have
association of race (black and white) and immigration status(only within black) 
with the development of chronic disease in USA? 

cholestorol (BPQ080),  ##almost no NA, only 3
blood pressure(BPQ020), ##almost no NA, only 3, 1 yes, 2 no, 7 refused, 10 donot know
diabatics (a complete other dataset, itself diabatics, diq010)


Just within black, can we compare between male/female?
categorize gender male, female # RIAGENDR - Gender


##solution of Q1

```{r}
df_modified_demography=
  df_demography|>
  mutate(clg_education=ifelse(DMDEDUC2>3,1,0))|> #pull(DMDEDUC2)|>table(), >3 college education
  mutate(clg_education=ifelse(clg_education=="NA",0,clg_education))|>##"NA" also no clg education
  mutate(nh_black=ifelse(RIDRETH1==4,1,0))|>#|>pull(RIDRETH1)|>table() ## Non Hispanic black are 1, rst 0
  mutate(nh_white=ifelse(RIDRETH1==3,2,0))|>## Non Hispanic white are 2, rst 0
  mutate(nh_black_white=nh_black+nh_white)
  #pull(RIAGENDR)|>table(), 1 male, 2 female, check from doc file, no NA
  
df_modified_bloodpressure=
  data_bloodpressure|>
  dplyr::select(c("SEQN","BPQ020"))|>
  mutate(blood_pressure=ifelse(BPQ020>1,2,1))|> ##if donot know or refused, lets say them no,##1 yes, 2 no.
 mutate(blood_pressure=ifelse(blood_pressure=="NA",2,blood_pressure))

df_modified_bloodpressure_demography=
  df_modified_bloodpressure|>
  left_join(df_modified_demography,by=c("SEQN"))


dim(df_modified_bloodpressure_demography)
```

```{r}
df_modified_bloodpressure|>pull(blood_pressure)|>table()
```


```{r}
df_modified_bloodpressure_demography|>
  dplyr::select(c("nh_black_white","SEQN","blood_pressure","clg_education","RIAGENDR"))|>
  na.omit()|> ## still some NA, so just drop them
  summary()
```
```{r}
##nh black=1, white=2
##bp=1 yes, 2 no
##clg_education= 1 yes, 0 no
##gender RIAGENDR=1 male 2 female 
nh_bp_edu_gender=
  df_modified_bloodpressure_demography|>
  dplyr::select(c("nh_black_white","SEQN","blood_pressure","clg_education","RIAGENDR"))|>
  na.omit()
```


```{r}
nh_bp_gender_table <- table(nh_bp_edu_gender[,"blood_pressure"], nh_bp_edu_gender[,"RIAGENDR"])
nh_bp_gender_table
```





##1.categrize Age yong adults(18-39), middle age (40-59), older adults (>60)
(Not now!)
##2. categorize gender male, female # RIAGENDR - Gender
##3. having high blood pressure greater than 2 times in doctor visit. yes no
###in black. origin category, what is the prevalence of 
#high bloodpressure in young adults vs older adults

##4. may compare black and white

##<https://wwwn.cdc.gov/Nchs/Nhanes/2021-2022/DBQ_L.htm> diet nutrition data


```{r}

```

Q2. Blood pressure 0/1 (BPQ020). 
DBQ930 - Main meal planner/preparer: {Are you/Is SP} the person who does 
most of the planning or preparing of meals in {your/SP's} family?0/1
If you do not prepare meal by yourself, you can have hypertension as somebody else who is preparing food for you, might not know about your health condition. You can also eat junk food!



##problem 2:
#DBQ930 - Main meal planner/preparer
##if black people do prepare food at home or outside while having hypertention
##link age, gender, meal, education level


Q3: Maybe this variables are a bit complicated, we try other data
Take 2 variables:
PAD790Q - Frequency of moderate LTPA,
PAD810Q - Frequency of vigorous LTPA

If it is greater than 150 min per week of moderate PA or 75 min per week of vigorous PA

If black adult does 150 minuites or more Physical Activity (PA), then prevalence
of hypertension. 


https://wwwn.cdc.gov/Nchs/Nhanes/2021-2022/PAQ_L.htm



##problem 3:
#https://wwwn.cdc.gov/Nchs/Nhanes/2021-2022/PAQ_L.htm for physical activity
#PAD800 - Minutes moderate LTPA how much to do exercisein leisure time
##check if black adults had enough physical activity and blood pressure relation
#



