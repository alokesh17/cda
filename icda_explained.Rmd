---
title: "icda_explained"
author: "Alokesh Manna"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
install.packages("devtools")
library(devtools)
install_github("presnell/icda")
```
Cola preference
```{r}
dbinom(0, 3, .6)
dbinom(1, 3, .6)
dbinom(0:3, 3, .6)
cbind(0:3, dbinom(0:3, 3, .6))


###################################################
### code chunk number 9: icda-notes.Rnw:490-492
###################################################
```
1. How to plot a PMF? type = "h"
```{r}
plot(0:3, dbinom(0:3, 3, .6), type = "h",
     xlab = "y", ylab = "P(y)")


```
2. Plot a overall distribution
```{r}
opar <- par(mfrow=c(1,2))
plot(0:8, dbinom(0:8,8,.2), type="h", xlab="y", ylab="p(y)",
main=expression(paste("Binomial(n=8, ",pi,"=.2)")))
plot(0:15, dbinom(0:15,25,.2), type="h", xlab="y", ylab="p(y)",
main=expression(paste("Binomial(n=25, ",pi,"=.2)")))
par(opar)

```
3. A curve? curve has an argument as x. Also we want to show different segments.
```{r}
curve(dbinom(1,3,x), xlim = c(0,1),
xlab=expression(paste("Binomial parameter: ",pi)),
ylab=expression(paste("Likelihood:  ", l(pi))))

curve(dbinom(1,3,x), xlim = c(0,1), xaxt="n",
      xlab=expression(paste("Binomial parameter: ",pi)),
      ylab=expression(paste("Likelihood: ", l(pi))))
axis(1, at=c(0,1/3,1), labels=c("0","1/3","1"))
segments(1/3, 0, 1/3, dbinom(1, 3, 1/3), lty=2)

curve(dbinom(3,3,x), xlim = c(0,1),
      xlab=expression(paste("Binomial parameter: ",pi)),
      ylab=expression(paste("Likelihood: ", l(pi))))
segments(1, 0, 1, dbinom(3, 3, 1), lty=2)


```
4.
Null: x/n = .5 if there is only one group.

prop.test(x, n, p = NULL,
          alternative = c("two.sided", "less", "greater"),
          conf.level = 0.95, correct = TRUE)
          
CI is constructed based on normality assumption. It keeps [-1,1] or
[0,1] depending on whether the test is for 1 or 2 group. 

Continuity correction is used only if it does not exceed the 
difference between sample and null proportions in absolute value. 

```{r}
prop.test(0,20)
```
For very small n, do inference using the exact binomial sampling
distribution of the data, instead of the normal approximation.

R Functions for Simple Binomial Tests and CI
```{r}
binom.test(0,20)
```
5. contingency table from page 35 <https://huskyct.uconn.edu/ultra/courses/_150350_1/cl/outline>

```{r}
phs <- matrix(c(189, 10845, 104, 10933), ncol = 2, byrow = TRUE)
dimnames(phs) <- 
  list(Group = c("Placebo","Aspirin"), MI = c("Y", "N"))

```


```{r}
phs
```
If you get a positive result, more relevant to you is Pr(X = 1|Y = 1). If
disease is relatively rare, this may be low even if sensitivity and
specificity are high.

Statistical independence test:
1. direct method:
$SE(p1 − p2) = \sqrt{p1(1 − p1)/n1+ p2(1 − p2)/n2}$
use the normality and CI approach.
If $p1 − p2+/-SE(p1 − p2)$ includes 0, no significant difference.

2.$\text{odd ratio} =(π1/(1 − π1))/(π2/(1 − π2))=π1(1 − π2)/π2(1 − π1)$
Test for $\text{odd ratio}=1$ or not!
$SE(log odd ratio) = \sqrt{1/n11+1/n12+1/n21+1/n22}$
So now use the CI $log odd ratio+/-1.96 SE$

3. Chi square independence test. df:(I-1)(J-1). one sided test.

4. Liklihood ration test. $-2log(\text{liklihood under} H_{0}/\text{liklihood under} H_{1})$. df:(I-1)(J-1). one sided test.

```{r}
pag.tab <- matrix(c(762, 484, 327, 239, 468, 477), nrow=2)
dimnames(pag.tab) <- 
  list(Gender=c("Female","Male"),
       Party=c("Democrat","Independent","Republican"))
pag.tab <- as.table(pag.tab)
pag.tab


###################################################
### code chunk number 36: icda-notes.Rnw:1965-1967
###################################################
pag.df <- as.data.frame(pag.tab)
pag.df


###################################################
### code chunk number 37: icda-notes.Rnw:1977-1982
###################################################
pag.df <- 
  expand.grid(Gender=c("Female","Male"),
             Party=c("Democrat","Independent","Republican"))
pag.df
pag.df$Freq <- c(762, 484, 327, 239, 468, 477)


###################################################
### code chunk number 38: icda-notes.Rnw:1990-1992
###################################################
pag.df
xtabs(Freq ~ Gender + Party, data=pag.df)


###################################################
### code chunk number 39: icda-notes.Rnw:2008-2009 (eval = FALSE)
###################################################
## pag.df <- read.table("Data/pag.txt", header=TRUE)


```
```{r}
pag.tab
margin.table(pag.tab, 1)
margin.table(pag.tab, 2)


###################################################
### code chunk number 42: icda-notes.Rnw:2042-2043
###################################################
addmargins(pag.tab)


###################################################
### code chunk number 43: icda-notes.Rnw:2054-2056
###################################################
prop.table(pag.tab)
round(prop.table(pag.tab), 3)


###################################################
### code chunk number 44: icda-notes.Rnw:2066-2067
###################################################
prop.table(pag.tab, 1)


###################################################
### code chunk number 45: icda-notes.Rnw:2071-2072
###################################################
prop.table(pag.tab, 2)

```

chisquare test
```{r}
chisq.test(pag.tab)


###################################################
### code chunk number 47: icda-notes.Rnw:2091-2096
###################################################
pag.chisq <- chisq.test(pag.tab)
names(pag.chisq)
pag.chisq$statistic
pag.chisq$parameter
pag.chisq$p.value
```
```{r}
###################################################
pag.chisq$observed
pag.chisq$expected
with(pag.chisq, sum((observed - expected)^2/expected))

```

```{r}
###################################################
pag.chisq$residuals


###################################################
### code chunk number 50: icda-notes.Rnw:2125-2126
###################################################
pag.chisq$stdres

```

